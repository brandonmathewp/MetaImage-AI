<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta AI - Venice API Image Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-bg: #0a0a0a;
            --secondary-bg: #111111;
            --card-bg: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --accent-color: #00ffff;
            --accent-hover: #00e6e6;
            --border-color: #333333;
            --success-color: #00ff88;
            --warning-color: #ffaa00;
            --error-color: #ff5555;
            --shadow: 0 4px 20px rgba(0, 255, 255, 0.1);
            --radius: 12px;
            --radius-sm: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, #0d1a1a 100%);
            padding: 1.5rem 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            color: var(--accent-color);
            font-size: 2rem;
        }

        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-color), #00ccff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .balance-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 1rem 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .balance-icon {
            color: var(--accent-color);
            font-size: 1.5rem;
        }

        .balance-info h3 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .balance-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        /* Main Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        @media (min-width: 992px) {
            .main-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Settings Panel */
        .settings-panel {
            background: var(--secondary-bg);
            border-radius: var(--radius);
            padding: 2rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            color: var(--accent-color);
        }

        .panel-title i {
            font-size: 1.5rem;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 255, 255, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper i {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-color);
            pointer-events: none;
        }

        /* Dimensions */
        .dimensions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .dimension-presets {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .preset-btn {
            padding: 0.4rem 0.8rem;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .preset-btn.active {
            background: var(--accent-color);
            color: var(--primary-bg);
            border-color: var(--accent-color);
        }

        /* Toggle Switch */
        .toggle-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 0.75rem 1rem;
        }

        .toggle-label {
            margin-bottom: 0;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #333;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--accent-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Cost Display */
        .cost-display {
            background: linear-gradient(135deg, #001a1a 0%, var(--card-bg) 100%);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid var(--border-color);
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .cost-total {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-color);
            border-top: 1px solid var(--border-color);
            padding-top: 0.5rem;
            margin-top: 0.5rem;
        }

        /* Generate Button */
        .generate-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--accent-color), #00aaff);
            border: none;
            border-radius: var(--radius);
            color: var(--primary-bg);
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 255, 255, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Gallery */
        .gallery-section {
            background: var(--secondary-bg);
            border-radius: var(--radius);
            padding: 2rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .gallery-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
            color: var(--accent-color);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .image-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }

        .image-container {
            width: 100%;
            aspect-ratio: 1;
            overflow: hidden;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .generated-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .image-container:hover .generated-image {
            transform: scale(1.05);
        }

        .image-info {
            padding: 1rem;
        }

        .image-info h4 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .image-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .image-cost {
            color: var(--accent-color);
            font-weight: 600;
        }

        .empty-gallery {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-gallery i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--border-color);
        }

        /* Footer */
        footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--secondary-bg);
            border-top: 1px solid var(--border-color);
            padding: 1rem 0;
            z-index: 100;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copyright {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .tos-link {
            color: var(--accent-color);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.2s;
        }

        .tos-link:hover {
            color: var(--accent-hover);
            text-decoration: underline;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--secondary-bg);
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--accent-color);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
        }

        .close-modal:hover {
            color: var(--accent-color);
        }

        .tos-content {
            color: var(--text-secondary);
            line-height: 1.8;
        }

        .tos-content h3 {
            color: var(--text-primary);
            margin: 1.5rem 0 0.5rem 0;
            font-size: 1.2rem;
        }

        .tos-content p {
            margin-bottom: 1rem;
        }

        .api-key-input {
            display: flex;
            gap: 10px;
        }

        .api-key-input input {
            flex: 1;
        }

        .save-key-btn {
            background: var(--accent-color);
            color: var(--primary-bg);
            border: none;
            border-radius: var(--radius-sm);
            padding: 0 1.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .save-key-btn:hover {
            background: var(--accent-hover);
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Status Messages */
        .status-message {
            padding: 1rem;
            border-radius: var(--radius-sm);
            margin: 1rem 0;
            display: none;
        }

        .status-message.active {
            display: block;
        }

        .status-success {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }

        .status-error {
            background: rgba(255, 85, 85, 0.1);
            border: 1px solid var(--error-color);
            color: var(--error-color);
        }

        .status-warning {
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid var(--warning-color);
            color: var(--warning-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .balance-card {
                width: 100%;
                justify-content: center;
            }

            .dimensions-grid {
                grid-template-columns: 1fr;
            }

            .footer-content {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-robot logo-icon"></i>
                    <div class="logo-text">
                        <h1>Meta AI</h1>
                        <p>Venice API Image Generator</p>
                    </div>
                </div>
                <div class="balance-card">
                    <i class="fas fa-wallet balance-icon"></i>
                    <div class="balance-info">
                        <h3>Available Balance</h3>
                        <div class="balance-amount" id="balanceDisplay">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <div class="main-grid">
            <!-- Settings Panel -->
            <div class="settings-panel">
                <div class="panel-title">
                    <i class="fas fa-sliders-h"></i>
                    <span>Generation Settings</span>
                </div>

                <!-- API Key Button -->
                <div class="form-group">
                    <button class="generate-btn" id="apiKeyBtn" style="margin-bottom: 1rem;">
                        <i class="fas fa-key"></i>
                        Configure API Key
                    </button>
                </div>

                <!-- Status Messages -->
                <div id="statusMessage" class="status-message"></div>

                <!-- Model Selection -->
                <div class="form-group">
                    <label for="modelSelect"><i class="fas fa-cube"></i> AI Model</label>
                    <div class="select-wrapper">
                        <select id="modelSelect">
                            <option value="">Loading models...</option>
                        </select>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div id="modelInfo" style="margin-top: 0.5rem; font-size: 0.9rem; color: var(--text-secondary);"></div>
                </div>

                <!-- Prompt -->
                <div class="form-group">
                    <label for="promptInput"><i class="fas fa-comment-alt"></i> Prompt</label>
                    <textarea id="promptInput" placeholder="Describe the image you want to generate..."></textarea>
                </div>

                <!-- Negative Prompt -->
                <div class="form-group">
                    <label for="negativePrompt"><i class="fas fa-ban"></i> Negative Prompt (Optional)</label>
                    <textarea id="negativePrompt" placeholder="What you don't want in the image..."></textarea>
                </div>

                <!-- Dimensions -->
                <div class="form-group">
                    <label><i class="fas fa-expand-alt"></i> Dimensions</label>
                    <div class="dimensions-grid">
                        <div>
                            <input type="number" id="widthInput" min="64" max="1280" value="1024" placeholder="Width">
                        </div>
                        <div>
                            <input type="number" id="heightInput" min="64" max="1280" value="1024" placeholder="Height">
                        </div>
                    </div>
                    <div class="dimension-presets">
                        <button class="preset-btn" data-width="512" data-height="512">512×512</button>
                        <button class="preset-btn" data-width="768" data-height="768">768×768</button>
                        <button class="preset-btn active" data-width="1024" data-height="1024">1024×1024</button>
                        <button class="preset-btn" data-width="1024" data-height="768">1024×768</button>
                        <button class="preset-btn" data-width="768" data-height="1024">768×1024</button>
                    </div>
                </div>

                <!-- Style -->
                <div class="form-group">
                    <label for="styleSelect"><i class="fas fa-palette"></i> Style</label>
                    <div class="select-wrapper">
                        <select id="styleSelect">
                            <option value="">Loading styles...</option>
                        </select>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>

                <!-- Advanced Options -->
                <div class="form-group">
                    <label><i class="fas fa-cog"></i> Advanced Options</label>
                    <div class="toggle-group">
                        <span class="toggle-label">Safe Mode</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="safeMode" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="toggle-group" style="margin-top: 0.5rem;">
                        <span class="toggle-label">Hide Watermark</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="hideWatermark">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <!-- Cost Display -->
                <div class="cost-display">
                    <div class="cost-item">
                        <span>Model Cost:</span>
                        <span id="modelCost">-</span>
                    </div>
                    <div class="cost-item">
                        <span>Resolution Cost:</span>
                        <span id="resolutionCost">-</span>
                    </div>
                    <div class="cost-item cost-total">
                        <span>Total Estimated Cost:</span>
                        <span id="totalCost">-</span>
                    </div>
                </div>

                <!-- Generate Button -->
                <button class="generate-btn" id="generateBtn" disabled>
                    <i class="fas fa-magic"></i>
                    Generate Image
                </button>
            </div>

            <!-- Gallery -->
            <div class="gallery-section">
                <div class="gallery-header">
                    <div class="gallery-title">
                        <i class="fas fa-images"></i>
                        <span>Generated Images</span>
                    </div>
                    <button id="clearGallery" style="background: none; border: none; color: var(--text-secondary); cursor: pointer;">
                        <i class="fas fa-trash"></i> Clear
                    </button>
                </div>
                <div class="gallery-grid" id="galleryGrid">
                    <div class="empty-gallery">
                        <i class="fas fa-image"></i>
                        <p>No images generated yet</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Your generated images will appear here</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="copyright">
                    &copy; 2024 Meta AI Image Generator. All rights reserved.
                </div>
                <a href="#" class="tos-link" id="tosLink">
                    <i class="fas fa-file-contract"></i> Terms of Service
                </a>
            </div>
        </div>
    </footer>

    <!-- API Key Modal -->
    <div class="modal" id="apiKeyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Configure API Key</h3>
                <button class="close-modal" id="closeApiKeyModal">&times;</button>
            </div>
            <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
                Enter your Venice API key to generate images. You can create an API key at 
                <a href="https://venice.ai" target="_blank" style="color: var(--accent-color);">venice.ai</a>
            </p>
            <div class="api-key-input">
                <input type="password" id="apiKeyInput" placeholder="sk-...">
                <button class="save-key-btn" id="saveApiKey">Save</button>
            </div>
            <div id="apiKeyStatus" class="status-message" style="margin-top: 1rem;"></div>
        </div>
    </div>

    <!-- Terms of Service Modal -->
    <div class="modal" id="tosModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Terms of Service</h3>
                <button class="close-modal" id="closeTosModal">&times;</button>
            </div>
            <div class="tos-content">
                <p><strong>Last Updated: January 16, 2026</strong></p>
                
                <h3>1. Acceptance of Terms</h3>
                <p>By using Meta AI Image Generator, you agree to these Terms of Service and our Privacy Policy. If you do not agree, please do not use our service.</p>
                
                <h3>2. Service Description</h3>
                <p>Meta AI provides an interface to the Venice API for AI image generation. We are not responsible for the AI models or their outputs.</p>
                
                <h3>3. User Responsibilities</h3>
                <p>You agree not to use the service to generate:</p>
                <ul style="margin-left: 1.5rem; margin-bottom: 1rem;">
                    <li>Illegal, harmful, or offensive content</li>
                    <li>Copyrighted material without permission</li>
                    <li>Explicit adult content</li>
                    <li>Content promoting violence or hate</li>
                    <li>Misleading or fraudulent content</li>
                </ul>
                
                <h3>4. AI Image Generation Specific Terms</h3>
                <p>a. Generated images may be influenced by training data biases.</p>
                <p>b. AI may produce unexpected or inaccurate results.</p>
                <p>c. You are responsible for reviewing and validating generated content.</p>
                <p>d. Do not use generated images for critical applications without human review.</p>
                <p>e. Respect intellectual property rights in prompts and outputs.</p>
                
                <h3>5. Content Policy</h3>
                <p>We reserve the right to refuse service to anyone generating content that violates our policies or applicable laws.</p>
                
                <h3>6. API Usage and Costs</h3>
                <p>a. You are responsible for all costs incurred through the Venice API.</p>
                <p>b. Monitor your usage to avoid unexpected charges.</p>
                <p>c. We display estimated costs but actual charges may vary.</p>
                
                <h3>7. INDEMNIFICATION AND HOLD HARMLESS AGREEMENT</h3>
                <p><strong>YOU AGREE TO DEFEND, INDEMNIFY, AND HOLD HARMLESS Meta AI, its owners, operators, employees, and affiliates from and against any and all claims, damages, obligations, losses, liabilities, costs, debt, and expenses (including but not limited to attorney's fees) arising from:</strong></p>
                <ul style="margin-left: 1.5rem; margin-bottom: 1rem;">
                    <li>Your use of and access to the service</li>
                    <li>Your violation of any term of these Terms of Service</li>
                    <li>Your violation of any third-party right, including without limitation any copyright, property, or privacy right</li>
                    <li>Any content you generate, share, or distribute through the service</li>
                    <li>Any claim that your generated content caused damage to a third party</li>
                    <li>Your violation of any applicable law, rule, or regulation</li>
                    <li>Any other party's access and use of the service with your unique API key</li>
                </ul>
                <p>This indemnification obligation will survive these Terms of Service and your use of the Meta AI service.</p>
                
                <h3>8. Disclaimer of Warranties</h3>
                <p>The service is provided "as is" without warranties of any kind. We do not guarantee uninterrupted or error-free service.</p>
                
                <h3>9. Limitation of Liability</h3>
                <p>To the maximum extent permitted by law, Meta AI shall not be liable for any indirect, incidental, or consequential damages.</p>
                
                <h3>10. Modifications</h3>
                <p>We reserve the right to modify these terms at any time. Continued use constitutes acceptance of changes.</p>
                
                <h3>11. Governing Law</h3>
                <p>These terms shall be governed by the laws of the United States and the State of Delaware.</p>
                
                <h3>12. Contact</h3>
                <p>For questions about these Terms, contact: legal@meta-ai-generator.example.com</p>
            </div>
        </div>
    </div>

    <script>
        // State Management
        const state = {
            apiKey: localStorage.getItem('venice_api_key') || '',
            models: [],
            styles: [],
            balance: { USD: 0, DIEM: 0 },
            selectedModel: null,
            generatedImages: JSON.parse(localStorage.getItem('generated_images') || '[]'),
            rateLimits: null
        };

        // DOM Elements
        const elements = {
            // Inputs
            apiKeyInput: document.getElementById('apiKeyInput'),
            modelSelect: document.getElementById('modelSelect'),
            promptInput: document.getElementById('promptInput'),
            negativePrompt: document.getElementById('negativePrompt'),
            widthInput: document.getElementById('widthInput'),
            heightInput: document.getElementById('heightInput'),
            styleSelect: document.getElementById('styleSelect'),
            safeMode: document.getElementById('safeMode'),
            hideWatermark: document.getElementById('hideWatermark'),
            
            // Buttons
            generateBtn: document.getElementById('generateBtn'),
            apiKeyBtn: document.getElementById('apiKeyBtn'),
            saveApiKey: document.getElementById('saveApiKey'),
            clearGallery: document.getElementById('clearGallery'),
            
            // Modals
            apiKeyModal: document.getElementById('apiKeyModal'),
            tosModal: document.getElementById('tosModal'),
            closeApiKeyModal: document.getElementById('closeApiKeyModal'),
            closeTosModal: document.getElementById('closeTosModal'),
            tosLink: document.getElementById('tosLink'),
            
            // Display
            balanceDisplay: document.getElementById('balanceDisplay'),
            galleryGrid: document.getElementById('galleryGrid'),
            statusMessage: document.getElementById('statusMessage'),
            apiKeyStatus: document.getElementById('apiKeyStatus'),
            modelInfo: document.getElementById('modelInfo'),
            
            // Cost
            modelCost: document.getElementById('modelCost'),
            resolutionCost: document.getElementById('resolutionCost'),
            totalCost: document.getElementById('totalCost')
        };

        // Venice API Configuration
        const API_CONFIG = {
            BASE_URL: 'https://api.venice.ai/api/v1',
            ENDPOINTS: {
                MODELS: '/models?type=image',
                STYLES: '/image/styles',
                GENERATE: '/image/generate',
                BALANCE: '/api_keys/rate_limits'
            }
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', () => {
            initEventListeners();
            checkApiKey();
        });

        function initEventListeners() {
            // API Key Management
            elements.apiKeyBtn.addEventListener('click', () => showModal(elements.apiKeyModal));
            elements.saveApiKey.addEventListener('click', saveApiKey);
            elements.closeApiKeyModal.addEventListener('click', () => hideModal(elements.apiKeyModal));
            elements.apiKeyInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') saveApiKey();
            });

            // ToS Modal
            elements.tosLink.addEventListener('click', (e) => {
                e.preventDefault();
                showModal(elements.tosModal);
            });
            elements.closeTosModal.addEventListener('click', () => hideModal(elements.tosModal));

            // Generation
            elements.generateBtn.addEventListener('click', generateImage);
            elements.promptInput.addEventListener('input', validateForm);
            elements.modelSelect.addEventListener('change', onModelChange);
            elements.widthInput.addEventListener('input', updateCost);
            elements.heightInput.addEventListener('input', updateCost);

            // Dimension Presets
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const width = parseInt(btn.dataset.width);
                    const height = parseInt(btn.dataset.height);
                    elements.widthInput.value = width;
                    elements.heightInput.value = height;
                    
                    // Update active state
                    document.querySelectorAll('.preset-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    updateCost();
                    validateForm();
                });
            });

            // Gallery
            elements.clearGallery.addEventListener('click', clearGallery);

            // Close modals on outside click
            [elements.apiKeyModal, elements.tosModal].forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) hideModal(modal);
                });
            });
        }

        function showModal(modal) {
            modal.classList.add('active');
        }

        function hideModal(modal) {
            modal.classList.remove('active');
        }

        function checkApiKey() {
            if (state.apiKey) {
                elements.apiKeyInput.value = state.apiKey;
                loadInitialData();
            } else {
                showModal(elements.apiKeyModal);
                showStatus('Please enter your Venice API key to continue', 'warning', elements.apiKeyStatus);
            }
        }

        function saveApiKey() {
            const apiKey = elements.apiKeyInput.value.trim();
            
            if (!apiKey) {
                showStatus('Please enter an API key', 'error', elements.apiKeyStatus);
                return;
            }

            if (!apiKey.startsWith('sk-')) {
                showStatus('API key should start with "sk-"', 'warning', elements.apiKeyStatus);
            }

            state.apiKey = apiKey;
            localStorage.setItem('venice_api_key', apiKey);
            hideModal(elements.apiKeyModal);
            showStatus('API key saved successfully!', 'success', elements.statusMessage);
            
            loadInitialData();
        }

        async function loadInitialData() {
            try {
                elements.generateBtn.disabled = true;
                elements.generateBtn.innerHTML = '<div class="loading"></div> Loading...';
                
                await Promise.all([
                    fetchModels(),
                    fetchStyles(),
                    fetchBalance()
                ]);
                
                renderGallery();
                validateForm();
                
            } catch (error) {
                showStatus(`Failed to load data: ${error.message}`, 'error');
                elements.generateBtn.disabled = true;
                elements.generateBtn.innerHTML = '<i class="fas fa-magic"></i> Generate Image';
            }
        }

        async function fetchModels() {
            try {
                const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.MODELS}`, {
                    headers: { 'Authorization': `Bearer ${state.apiKey}` }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Invalid API key');
                    }
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                state.models = data.data.filter(model => model.type === 'image');
                
                populateModelSelect();
                
            } catch (error) {
                showStatus(`Failed to load models: ${error.message}`, 'error');
                throw error;
            }
        }

        function populateModelSelect() {
            elements.modelSelect.innerHTML = '<option value="">Select a model...</option>';
            
            state.models.forEach(model => {
                const option = document.createElement('option');
                option.value = model.id;
                option.textContent = `${model.model_spec.name} (${model.id})`;
                elements.modelSelect.appendChild(option);
            });
        }

        async function fetchStyles() {
            try {
                const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.STYLES}`, {
                    headers: { 'Authorization': `Bearer ${state.apiKey}` }
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                state.styles = data.data;
                
                populateStyleSelect();
                
            } catch (error) {
                showStatus(`Failed to load styles: ${error.message}`, 'warning');
            }
        }

        function populateStyleSelect() {
            elements.styleSelect.innerHTML = '<option value="">No style (default)</option>';
            
            state.styles.forEach(style => {
                const option = document.createElement('option');
                option.value = style;
                option.textContent = style;
                elements.styleSelect.appendChild(option);
            });
        }

        async function fetchBalance() {
            try {
                const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.BALANCE}`, {
                    headers: { 'Authorization': `Bearer ${state.apiKey}` }
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                state.balance = data.data.balances;
                state.rateLimits = data.data.rateLimits;
                
                updateBalanceDisplay();
                
            } catch (error) {
                showStatus(`Failed to load balance: ${error.message}`, 'warning');
            }
        }

        function updateBalanceDisplay() {
            const usd = state.balance.USD ? `$${state.balance.USD.toFixed(2)}` : '$0.00';
            const diem = state.balance.DIEM ? `${state.balance.DIEM.toFixed(2)} DIEM` : '0 DIEM';
            elements.balanceDisplay.textContent = `${usd} / ${diem}`;
        }

        function onModelChange() {
            const modelId = elements.modelSelect.value;
            state.selectedModel = state.models.find(m => m.id === modelId);
            
            if (state.selectedModel) {
                updateModelInfo();
                updateCost();
                
                // Update dimension constraints
                const constraints = state.selectedModel.model_spec.constraints;
                if (constraints && constraints.widthHeightDivisor) {
                    const divisor = constraints.widthHeightDivisor;
                    elements.widthInput.min = divisor * 10;
                    elements.heightInput.min = divisor * 10;
                }
            }
            
            validateForm();
        }

        function updateModelInfo() {
            if (!state.selectedModel) {
                elements.modelInfo.innerHTML = '';
                return;
            }

            const spec = state.selectedModel.model_spec;
            let info = '';
            
            if (spec.description) {
                info += `<div><strong>${spec.description}</strong></div>`;
            }
            
            if (spec.pricing) {
                const pricing = spec.pricing;
                if (pricing.resolutions) {
                    info += `<div style="margin-top: 5px;">Supports multiple resolutions</div>`;
                } else if (pricing.generation) {
                    info += `<div style="margin-top: 5px;">Base cost: $${pricing.generation.usd} / ${pricing.generation.diem} DIEM</div>`;
                }
            }
            
            if (spec.constraints) {
                const constraints = spec.constraints;
                if (constraints.promptCharacterLimit) {
                    info += `<div style="margin-top: 5px;">Prompt limit: ${constraints.promptCharacterLimit} chars</div>`;
                }
            }
            
            elements.modelInfo.innerHTML = info;
        }

        function updateCost() {
            if (!state.selectedModel) {
                elements.modelCost.textContent = '-';
                elements.resolutionCost.textContent = '-';
                elements.totalCost.textContent = '-';
                return;
            }

            const width = parseInt(elements.widthInput.value) || 1024;
            const height = parseInt(elements.heightInput.value) || 1024;
            const pricing = state.selectedModel.model_spec.pricing;
            
            let modelCost = 0;
            let resolutionCost = 0;
            
            if (pricing.resolutions) {
                // Determine resolution tier
                const pixels = width * height;
                let resolution = '1K';
                if (pixels >= 2000000) resolution = '2K';
                if (pixels >= 8000000) resolution = '4K';
                
                if (pricing.resolutions[resolution]) {
                    resolutionCost = pricing.resolutions[resolution].usd;
                }
            } else if (pricing.generation) {
                modelCost = pricing.generation.usd;
            }
            
            elements.modelCost.textContent = modelCost ? `$${modelCost.toFixed(2)}` : 'Included';
            elements.resolutionCost.textContent = resolutionCost ? `$${resolutionCost.toFixed(2)}` : 'Included';
            elements.totalCost.textContent = `$${(modelCost + resolutionCost).toFixed(2)}`;
        }

        function validateForm() {
            const isValid = 
                state.apiKey &&
                elements.modelSelect.value &&
                elements.promptInput.value.trim() &&
                elements.widthInput.value &&
                elements.heightInput.value;
            
            elements.generateBtn.disabled = !isValid;
            
            if (isValid) {
                elements.generateBtn.innerHTML = '<i class="fas fa-magic"></i> Generate Image';
            } else {
                elements.generateBtn.innerHTML = '<i class="fas fa-magic"></i> Fill all required fields';
            }
            
            return isValid;
        }

        async function generateImage() {
            if (!validateForm()) return;
            
            const prompt = elements.promptInput.value.trim();
            const negativePrompt = elements.negativePrompt.value.trim();
            const width = parseInt(elements.widthInput.value);
            const height = parseInt(elements.heightInput.value);
            const model = elements.modelSelect.value;
            const style = elements.styleSelect.value;
            const safeMode = elements.safeMode.checked;
            const hideWatermark = elements.hideWatermark.checked;
            
            // Check balance
            if (state.balance.USD <= 0 && state.balance.DIEM <= 0) {
                showStatus('Insufficient balance. Please add funds to your Venice account.', 'error');
                return;
            }
            
            // Prepare request body
            const requestBody = {
                model: model,
                prompt: prompt,
                width: width,
                height: height,
                safe_mode: safeMode,
                hide_watermark: hideWatermark,
                format: 'webp'
            };
            
            if (negativePrompt) requestBody.negative_prompt = negativePrompt;
            if (style) requestBody.style_preset = style;
            
            try {
                elements.generateBtn.disabled = true;
                elements.generateBtn.innerHTML = '<div class="loading"></div> Generating...';
                showStatus('Generating image... This may take a moment.', 'success');
                
                const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.GENERATE}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${state.apiKey}`,
                        'Content-Type': 'application/json',
                        'Accept-Encoding': 'gzip, br'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    let errorMessage = `HTTP ${response.status}`;
                    
                    switch (response.status) {
                        case 400:
                            errorMessage = 'Invalid request parameters';
                            break;
                        case 401:
                            errorMessage = 'Invalid API key';
                            break;
                        case 402:
                            errorMessage = 'Insufficient balance';
                            break;
                        case 429:
                            errorMessage = 'Rate limit exceeded. Please wait before trying again.';
                            break;
                        case 500:
                            errorMessage = 'Server error. Please try again later.';
                            break;
                        case 503:
                            errorMessage = 'Model at capacity. Please try again later.';
                            break;
                    }
                    
                    const errorData = await response.json().catch(() => ({}));
                    if (errorData.error) {
                        errorMessage += `: ${errorData.error}`;
                    }
                    
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                
                // Add to gallery
                const imageData = {
                    id: data.id,
                    prompt: prompt,
                    model: model,
                    timestamp: new Date().toISOString(),
                    image: data.images[0],
                    cost: elements.totalCost.textContent
                };
                
                state.generatedImages.unshift(imageData);
                if (state.generatedImages.length > 20) {
                    state.generatedImages = state.generatedImages.slice(0, 20);
                }
                
                localStorage.setItem('generated_images', JSON.stringify(state.generatedImages));
                
                renderGallery();
                showStatus('Image generated successfully!', 'success');
                
                // Refresh balance
                await fetchBalance();
                
            } catch (error) {
                console.error('Generation error:', error);
                showStatus(`Generation failed: ${error.message}`, 'error');
            } finally {
                elements.generateBtn.disabled = false;
                elements.generateBtn.innerHTML = '<i class="fas fa-magic"></i> Generate Image';
                validateForm();
            }
        }

        function renderGallery() {
            if (state.generatedImages.length === 0) {
                elements.galleryGrid.innerHTML = `
                    <div class="empty-gallery">
                        <i class="fas fa-image"></i>
                        <p>No images generated yet</p>
                        <p style="font-size: 0.9rem; margin-top: 0.5rem;">Your generated images will appear here</p>
                    </div>
                `;
                return;
            }
            
            elements.galleryGrid.innerHTML = '';
            
            state.generatedImages.forEach((img, index) => {
                const card = document.createElement('div');
                card.className = 'image-card';
                card.innerHTML = `
                    <div class="image-container">
                        <img src="data:image/webp;base64,${img.image}" alt="${img.prompt}" class="generated-image">
                    </div>
                    <div class="image-info">
                        <h4 title="${img.prompt}">${img.prompt.length > 50 ? img.prompt.substring(0, 50) + '...' : img.prompt}</h4>
                        <div class="image-meta">
                            <span>${new Date(img.timestamp).toLocaleDateString()}</span>
                            <span class="image-cost">${img.cost}</span>
                        </div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    const link = document.createElement('a');
                    link.href = `data:image/webp;base64,${img.image}`;
                    link.download = `meta-ai-${img.id}.webp`;
                    link.click();
                });
                
                elements.galleryGrid.appendChild(card);
            });
        }

        function clearGallery() {
            if (state.generatedImages.length === 0) return;
            
            if (confirm('Clear all generated images?')) {
                state.generatedImages = [];
                localStorage.removeItem('generated_images');
                renderGallery();
                showStatus('Gallery cleared', 'success');
            }
        }

        function showStatus(message, type = 'info', element = null) {
            const target = element || elements.statusMessage;
            target.textContent = message;
            target.className = `status-message active status-${type}`;
            
            if (!element) {
                setTimeout(() => {
                    target.classList.remove('active');
                }, 5000);
            }
        }
    </script>
</body>
</html>
